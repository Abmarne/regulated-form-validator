import C from"js-yaml";function A(e){if(typeof e=="object"&&e!==null)return e;let t=String(e||"");try{return C.load(t)}catch(a){throw new Error("Invalid YAML/JSON config: "+a.message)}}function y(e){return/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(String(e||"").toUpperCase())}function h(e){return/^[A-Z]{4}0[A-Z0-9]{6}$/.test(String(e||"").toUpperCase())}function x(e){return/^\d{12}$/.test(String(e||""))}var $={pan:y,ifsc:h,aadhaar:x};function k(e,t){if(!e.when)return!0;let{field:a,equals:n,notEmpty:u,notEquals:g,in:d,notIn:c}=e.when,f=t==null?void 0:t[a];return n!==void 0?f===n:g!==void 0?f!==g:u?f!=null&&String(f).trim()!=="":Array.isArray(d)?d.includes(f):Array.isArray(c)?!c.includes(f):!0}function I(rule,value,values){if(!k(rule,values))return{valid:!0};switch(rule.type){case"required":return value==null||String(value).trim()===""?{valid:!1,message:rule.message||"This field is required"}:{valid:!0};case"regex":{let e=rule.flags||"";return new RegExp(rule.pattern,e).test(String(value??""))?{valid:!0}:{valid:!1,message:rule.message||"Invalid format"}}case"length":{let e=String(value??""),{min:t,max:a,eq:n}=rule;return typeof n=="number"&&e.length!==n?{valid:!1,message:rule.message||`Length must be ${n}`}:typeof t=="number"&&e.length<t?{valid:!1,message:rule.message||`Length must be \u2265 ${t}`}:typeof a=="number"&&e.length>a?{valid:!1,message:rule.message||`Length must be \u2264 ${a}`}:{valid:!0}}case"enum":return(rule.options||[]).includes(value)?{valid:!0}:{valid:!1,message:rule.message||"Invalid value"};case"number":{let e=Number(value);return Number.isNaN(e)?{valid:!1,message:rule.message||"Must be a number"}:rule.min!=null&&e<rule.min?{valid:!1,message:rule.message||`Must be \u2265 ${rule.min}`}:rule.max!=null&&e>rule.max?{valid:!1,message:rule.message||`Must be \u2264 ${rule.max}`}:{valid:!0}}case"date":{let e=new Date(value);if(Number.isNaN(e.getTime()))return{valid:!1,message:rule.message||"Invalid date"};if(rule.before&&e>=new Date(rule.before))return{valid:!1,message:rule.message||`Must be before ${rule.before}`};if(rule.after&&e<=new Date(rule.after))return{valid:!1,message:rule.message||`Must be after ${rule.after}`};if(rule.ageMin!=null){let t=new Date,a=t.getFullYear()-e.getFullYear(),n=t.getMonth()-e.getMonth();if((n<0||n===0&&t.getDate()<e.getDate())&&a--,a<rule.ageMin)return{valid:!1,message:rule.message||`Must be at least ${rule.ageMin}`}}return{valid:!0}}case"crossField":{let e=values==null?void 0:values[rule.field];return String(value??"")===String(e??"")?{valid:!0}:{valid:!1,message:rule.message||"Values must match"}}case"custom":{let fn=eval("("+rule.custom+")");return fn(value,values)?{valid:!0}:{valid:!1,message:rule.message||"Invalid value"}}default:return $[rule.type]?$[rule.type](value)?{valid:!0}:{valid:!1,message:rule.message||"Invalid input"}:{valid:!0}}}function v(e,t,a={}){for(let n of e.validation||[]){let u=I(n,t,a);if(!u.valid)return u}return{valid:!0}}function p(e=[],t={}){let a={};for(let n of e){let u=v(n,t[n.name],t);u.valid||(a[n.name]=u.message)}return{valid:Object.keys(a).length===0,errors:a}}import i,{useState as S}from"react";function w({config:e,onSubmit:t,renderField:a}){let n=Array.isArray(e==null?void 0:e.fields)?e.fields:[],[u,g]=S({}),[d,c]=S({}),[f,M]=S({}),F=(r,l)=>{let m=l!=null&&l.target?l.target.value:l,o={...u,[r.name]:m};g(o);let s=v(r,m,o);c({...d,[r.name]:s.valid?null:s.message})},q=r=>M(l=>({...l,[r.name]:!0})),D=r=>{r.preventDefault();let l=p(n,u);c(l.errors),l.valid&&typeof t=="function"&&t(u)},N=(r,l,m,o)=>{let s={name:r.name,value:l??"",onChange:m,onBlur:o,"aria-invalid":!!d[r.name],"aria-describedby":d[r.name]?`${r.name}-error`:void 0};switch(r.type){case"select":return i.createElement("select",{...s},i.createElement("option",{value:""},"Select..."),(r.options||[]).map(b=>i.createElement("option",{key:b,value:b},b)));case"textarea":return i.createElement("textarea",{...s,rows:3});case"number":return i.createElement("input",{...s,type:"number"});case"date":return i.createElement("input",{...s,type:"date"});default:return i.createElement("input",{...s,type:r.type||"text"})}},E=()=>{let r=Object.values(d).some(Boolean),m=n.filter(o=>(o.validation||[]).some(s=>s.type==="required"&&!s.when)).some(o=>{let s=u[o.name];return s==null||String(s).trim()===""});return r||m};return i.createElement("form",{onSubmit:D,noValidate:!0},n.map(r=>{let l=u[r.name],m=d[r.name],o=N(r,l,s=>F(r,s),()=>q(r));return i.createElement("div",{key:r.name,style:{marginBottom:12}},i.createElement("label",{htmlFor:r.name,style:{display:"block",fontWeight:600}},r.label),a?a(r,o,m):o,f[r.name]&&m&&i.createElement("span",{id:`${r.name}-error`,style:{color:"crimson",fontSize:12}},m))}),i.createElement("button",{type:"submit",disabled:E()},"Submit"))}var P={parseConfig:A,validateField:v,validateAll:p,FormRenderer:w};export{w as FormRenderer,P as default,A as parseConfig,p as validateAll,v as validateField};
