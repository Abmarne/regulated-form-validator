import L from"js-yaml";function A(e){if(typeof e=="object"&&e!==null)return e;let n=String(e||"");try{return L.load(n)}catch(r){throw new Error("Invalid YAML/JSON config: "+r.message)}}function x(e){return/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(String(e||"").toUpperCase())}function w(e){return/^[A-Z]{4}0[A-Z0-9]{6}$/.test(String(e||"").toUpperCase())}function S(e){return/^\d{12}$/.test(String(e||""))}var g=Object.create(null);g.mustContainXYZ=e=>String(e??"").includes("XYZ");g.isEven=e=>{let n=Number(e);return Number.isNaN(n)?!1:n%2===0};g.afterDate=(e,n,r)=>{var i;if(!((i=r==null?void 0:r.extra)!=null&&i.after))return!1;let t=new Date(e),a=new Date(r.extra.after);return!Number.isNaN(t.getTime())&&t>a};g.matchesRegex=(e,n,r)=>{var i,o;let t=(i=r==null?void 0:r.extra)==null?void 0:i.pattern;if(!t)return!1;let a=((o=r==null?void 0:r.extra)==null?void 0:o.flags)??"";return new RegExp(t,a).test(String(e??""))};function $(e,n){if(typeof e!="string"||!e)throw new Error("Custom rule name must be a non-empty string");if(typeof n!="function")throw new Error("Custom rule must be a function");g[e]=n}function M(e){delete g[e]}function b(e){return g[e]}function D(){return Object.keys(g)}var E={pan:x,ifsc:w,aadhaar:S};function O(e,n){if(!e.when)return!0;let{field:r,equals:t,notEmpty:a,notEquals:i,in:o,notIn:p}=e.when,d=n==null?void 0:n[r];return t!==void 0?d===t:i!==void 0?d!==i:a?d!=null&&String(d).trim()!=="":Array.isArray(o)?o.includes(d):Array.isArray(p)?!p.includes(d):!0}function Y(e,n,r){if(!O(e,r))return{valid:!0};switch(e.type){case"required":return n==null||String(n).trim()===""?{valid:!1,message:e.message||"This field is required"}:{valid:!0};case"regex":{let t=e.flags||"";return new RegExp(e.pattern,t).test(String(n??""))?{valid:!0}:{valid:!1,message:e.message||"Invalid format"}}case"length":{let t=String(n??""),{min:a,max:i,eq:o}=e;return typeof o=="number"&&t.length!==o?{valid:!1,message:e.message||`Length must be ${o}`}:typeof a=="number"&&t.length<a?{valid:!1,message:e.message||`Length must be \u2265 ${a}`}:typeof i=="number"&&t.length>i?{valid:!1,message:e.message||`Length must be \u2264 ${i}`}:{valid:!0}}case"enum":return(e.options||[]).includes(n)?{valid:!0}:{valid:!1,message:e.message||"Invalid value"};case"number":{let t=Number(n);return Number.isNaN(t)?{valid:!1,message:e.message||"Must be a number"}:e.min!=null&&t<e.min?{valid:!1,message:e.message||`Must be \u2265 ${e.min}`}:e.max!=null&&t>e.max?{valid:!1,message:e.message||`Must be \u2264 ${e.max}`}:{valid:!0}}case"date":{let t=new Date(n);if(Number.isNaN(t.getTime()))return{valid:!1,message:e.message||"Invalid date"};if(e.before&&t>=new Date(e.before))return{valid:!1,message:e.message||`Must be before ${e.before}`};if(e.after&&t<=new Date(e.after))return{valid:!1,message:e.message||`Must be after ${e.after}`};if(e.ageMin!=null){let a=new Date,i=a.getFullYear()-t.getFullYear(),o=a.getMonth()-t.getMonth();if((o<0||o===0&&a.getDate()<t.getDate())&&i--,i<e.ageMin)return{valid:!1,message:e.message||`Must be at least ${e.ageMin}`}}return{valid:!0}}case"crossField":{let t=r==null?void 0:r[e.field];return String(n??"")===String(t??"")?{valid:!0}:{valid:!1,message:e.message||"Values must match"}}case"custom":{let t=b(e.custom);return typeof t!="function"?{valid:!1,message:e.message||`Unknown custom rule: ${e.custom}`}:B(t,n,r,e)?{valid:!0}:{valid:!1,message:e.message||"Invalid value"}}default:return E[e.type]?E[e.type](n)?{valid:!0}:{valid:!1,message:e.message||"Invalid input"}:{valid:!0}}}function B(e,n,r,t){try{return!!e(n,r,t)}catch{return!1}}function v(e,n,r={}){for(let t of e.validation||[]){let a=Y(t,n,r);if(!a.valid)return a}return{valid:!0}}function y(e=[],n={}){let r={};for(let t of e){let a=v(t,n[t.name],n);a.valid||(r[t.name]=a.message)}return{valid:Object.keys(r).length===0,errors:r}}import f,{useState as C}from"react";function N({config:e,onSubmit:n,renderField:r}){let t=Array.isArray(e==null?void 0:e.fields)?e.fields:[],[a,i]=C({}),[o,p]=C({}),[d,F]=C({}),k=(s,u)=>{let l=u!=null&&u.target?u.target.value:u,c={...a,[s.name]:l};i(c);let m=v(s,l,c);p({...o,[s.name]:m.valid?null:m.message})},q=s=>F(u=>({...u,[s.name]:!0})),I=s=>{s.preventDefault();let u=y(t,a);p(u.errors),u.valid&&typeof n=="function"&&n(a)},Z=(s,u,l,c)=>{let m={id:s.name,name:s.name,value:u??"",onChange:l,onBlur:c,"aria-invalid":!!o[s.name],"aria-describedby":o[s.name]?`${s.name}-error`:void 0};switch(s.type){case"select":return f.createElement("select",{...m},f.createElement("option",{value:""},"Select..."),(s.options||[]).map(h=>f.createElement("option",{key:h,value:h},h)));case"textarea":return f.createElement("textarea",{...m,rows:3});case"number":return f.createElement("input",{...m,type:"number"});case"date":return f.createElement("input",{...m,type:"date"});default:return f.createElement("input",{...m,type:s.type||"text"})}},j=()=>{let s=Object.values(o).some(Boolean),l=t.filter(c=>(c.validation||[]).some(m=>m.type==="required"&&!m.when)).some(c=>{let m=a[c.name];return m==null||String(m).trim()===""});return s||l};return f.createElement("form",{onSubmit:I,noValidate:!0},t.map(s=>{let u=a[s.name],l=o[s.name],c=Z(s,u,m=>k(s,m),()=>q(s));return f.createElement("div",{key:s.name,style:{marginBottom:12}},f.createElement("label",{htmlFor:s.name,style:{display:"block",fontWeight:600}},s.label),r?r(s,c,l):c,d[s.name]&&l&&f.createElement("span",{id:`${s.name}-error`,style:{color:"crimson",fontSize:12}},l))}),f.createElement("button",{type:"submit",disabled:j()},"Submit"))}var se={parseConfig:A,validateField:v,validateAll:y,FormRenderer:N,addCustom:$,removeCustom:M,getCustom:b,listCustom:D};export{N as FormRenderer,$ as addCustom,se as default,b as getCustom,D as listCustom,A as parseConfig,M as removeCustom,y as validateAll,v as validateField};
